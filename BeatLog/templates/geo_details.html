{% extends "base.html" %}
{% block title %}Assess Geography{% endblock %}
{% block content %}
  <h1>Cached Geography Data</h1>
{% if bigs or littles %}
  <div class="row my-5">
	 <form method="POST" action="{{ url_for('geography.geography_assess') }}">
		<button type="submit" class="btn btn-light border-primary text-primary fw-bold ms-3 my-2" name="barchart" value="country_locs">Country Locations</button>
		<span class="fs-5 fw-bold mx-3">Top 10 bar charts:</span>
		<button type="submit" class="btn btn-primary fw-bold me-3 my-2" name="barchart" value="country_hits">Country Hits</button>
		<button type="submit" class="btn btn-primary fw-bold mx-3 my-2" name="barchart" value="country_IP">Country Visitors</button>	
		<button type="submit" class="btn btn-primary fw-bold mx-3 my-2" name="barchart" value="city_hits">City Hits</button>
		<button type="submit" class="btn btn-primary fw-bold mx-3 my-2" name="barchart" value="city_IP">City Visitors</button>
	  </form>   
  </div>
<hr>
  <div class="row">
    <h2 class="ms-3 mb-3">Locations per Country</h2>
	  <div class="text-warning mb-3 bg-secondary text-center py-2 fw-bold rounded col-5" style="margin:auto">
	    Click a <span class="text-light bg-dark fw-bold p-2 rounded">button</span> to view a location table, within which locations may be edited
	  </div>
  </div>
  <div class="row">
	{% if bigs %}
	  <div class="col mx-2"><form method="POST" action="{{ url_for('geography.geography_assess') }}">
		<b>Countries with at least 5 locations</b><br />
		  {% for country, count in bigs %}
		    <button class="btn btn-dark my-2 mx-2 btn-sm" type="submit" value="{{ country }}" name="country-select">{{ country }} - {{ count }}</button>
	      {% endfor %}
	  </form></div>
	{% endif %}
	{% if littles %}
	  <div class="col mx-2"><form method="POST" action="{{ url_for('geography.geography_assess') }}">
		<b>All countries with X locations</b><br />
		  {% for countries, count in littles %}
		    <button class="btn btn-dark my-2 mx-2 btn-sm" type="submit" value="{{ count }}" name="count-select">{{ countries }} countries with {{ count }} locations [{{countries * count }}]</button>
		  {% endfor %} 
	  </form></div>
	{% endif %}
  </div>
  <form method="POST" action="{{ url_for('geography.geography_assess') }}">
    <span class="text-muted fs-6" style="float:right;">View / Delete locations without associated IPs</span><br />
	<input type="submit" class="btn btn-success fw-bold mx-3" name="clean_cache" value="Clean Cache" style="float:right;">
	<input type="submit" class="btn btn-warning fw-bold mx-3" name="inspect" value="Inspect" style="float:right;">
  </form>
  <a href="{{ url_for('geography.geography_map') }}" class="btn btn-info fw-bold mx-3" target="_blank" style="float:left;">Recent Visitors Map</a>
<br /><hr />
  {% if alert %}
    <div class="alert alert-{{ alert[1] }} alert-dismissible fade show" role="alert">
	  {{ alert[0] }}
	  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}	
  {% if geo_table %}
	<div class="row mt-5">	
      <h2 class="ms-3">Geo Table</h2>
	  <table class="table table-sm table-responsive table-hover table-bordered table-striped-columns table-dark mx-3">
	    <thead><tr>{% if not IPs %}<th scope="col">ID</th>{% else %}<th scope="col">IPs</th>{% endif %}
	    <th scope="col">Lat</th><th scope="col">Lon</th><th scope="col">MapLink</th><th scope="col">City</th><th scope="col">Country</th><th scope="col"><em>modify</em></th></tr></thead>
	    <tbody>
		  {% for id, lat, lon, link1, link2, city, country  in geo_table %}
			<form method="POST" action="{{ url_for('geography.geography_assess') }}">
			  <tr>
				{% if not IPs %}
				  <th scope="row">{{ id }}</th>
				{% else %}
				  {% if IPs[id] == 0 %}<th scope="row" class="text-danger bg-light">{% else %}<th scope="row">{% endif %}{{ IPs[id] }}</th>
				{% endif %}
				<td>{{ lat }}</td><td>{{ lon }}</td>
				<td><a href="{{ link1 }}">OSM</a>, <a href="{{ link2 }}">GM</a></td>
				<td><input class="form-control bg-secondary" type="text" name="city" value="{{ city }}"></td>
				<td><input class="form-control bg-secondary" type="text" name="country" value="{{ country }}"></td>
				<td><button type="submit" class="btn btn-success btn-sm mx-1" value="{{ id }}" name="Update">Update</button>
				<button type="submit" class="btn btn-danger btn-sm mx-1" value="{{ id }}" name="Delete">Delete</td>
			  </tr>
			</form>
	      {% endfor %}
	    </tbody>
	  </table>
	</div>
  {% endif %}
  {% if chart %}
    <div class="row mt-5">
	  {% if chart[0] == 'CountryBarChart' %}
		<div id="{{ chart[0] }}" style="width:95%;height:90vh;margin:auto;z-index:0;"></div>
      {% else %}
		<div id="{{ chart[0] }}" style="width:95%;height:50vh;margin:auto;z-index:0;"></div>
      {% endif %}
    </div>
  {% endif %}
{% else %}
  <p class="text-danger fs-4 fw-bold text-center mt-5">No locations saved!</p>
{% endif %}
{% endblock %}

{% if chart %}
	{% block script_additions %}
	  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	  <script type="text/javascript">
	    {{ chart[1]|safe }}  
	  </script>	  
	{% endblock %}
{% endif %}